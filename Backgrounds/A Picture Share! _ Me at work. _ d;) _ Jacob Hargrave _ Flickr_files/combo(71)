YUI.add("photo-limit-overlay-view",function(e,t){require("hermes-core/flog")(t);var i=require("hermes-core/analytics");e.namespace("Views")[this.name]=e.Base.create("photo-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e=this.params.overlayClassList||[];this.setContainerWithTemplate("photo-limit-overlay",{additionalClasses:e.join(" ")})},activate:function(){var t=this,i=this.get("container");if(this.panelContainer=i.one(".panel-container"),this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name,!this.appContext.getCookie(this.dismissCookieName))return e.Promise.all([this.appContext.getModel("person-public-profile-models",this.appContext.getViewer().nsid).then(function(e){t.publicProfileModel=e}),this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e})]).then(function(){t.isLoaded=!0,t.fire("loaded")})},show:function(){var t,n,a,l,o,s=this,p=this.get("container"),r="",h=e.config.flickr.account.photo_limit,c=e.UserLimitsHelper.getARRCount(this.profileModel);this.appContext.getCookie(this.dismissCookieName)||(n=parseInt(this.publicProfileModel.getValue("totalViews")),a=parseInt(this.publicProfileModel.getValue("totalFaves")),l=parseInt(this.publicProfileModel.getValue("totalTags")),o=Math.max(c-h,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.RIGHT_NOW_PHOTOS_AT_RISK",count:o}))+"</p>",n>1&&a<=1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS",views:e.IntlNumber.format(n,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES",faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n<=1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_TAGS",tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES_TAGS",faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l>1&&(r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>"),r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.TAKE_MOMENT_TO_PROTECT_PHOTOS"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:0,title:this.intlMessage({intlName:"upload-blocking.PROTECT_THESE_PHOTOS"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.SAVE_YOUR_PHOTOS"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.MARK_PHOTOS_FOR_DELETION_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"}),initialActive:!0})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.UPGRADE_YOU_ALSO_GET"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:1,title:this.intlMessage({intlName:"upload-blocking.DID_YOU_KNOW_FLICKR_PRO"}),description:r,acceptButtonText:this.intlMessage({intlName:"refencing-announcement.UPGRADE_TO_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.CONTINUE_WITHOUT_SECURING_PHOTOS_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"})})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.FLICKR_PROS_LOVE_PHOTOGRAPHY"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:2,title:this.intlMessage({intlName:"upload-blocking.DONT_NEED_TO_BE_PROFESSIONAL"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.JOIN_FLICKR_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.DONT_REMIND_AGAIN_B"})})),t=this.panelContainer.all(".panel"),p.addClass("unhidden"),setTimeout(function(){p.addClass("active")},50),this.panelCount=t?t.size():0,i&&i.tl(!0,"o","Photo Limit Overlay: Show"),this.registerEventHandler(p.delegate("click",function(e){s.handleAcceptClick(e)},".accept-button")),this.registerEventHandler(p.delegate("click",function(e){s.handleDeclineClick(e)},".decline-button")))},hide:function(){var t=this.get("container");t.removeClass("active"),setTimeout(function(){t.removeClass("unhidden"),e.fire("photoLimitOverlay:hidden")},1e3)},showPanel:function(e){var t,i=this.get("container"),n=i.all(".panel"),a=i.one(".panel.active");e<n.size()&&(a.addClass("off-left"),a.removeClass("active"),setTimeout(function(){a.addClass("hidden")},1e3),(t=n.item(e)).removeClass("hidden"),t.addClass("active"),setTimeout(function(){t.removeClass("off-right")},50))},handleAcceptClick:function(t){i&&i.tl(e.one(t.target).getDOMNode(),"o","Photo Limit Overlay: Accept",null,"navigate")},handleDeclineClick:function(t){var n=t.target.ancestor(".panel",!0),a=parseInt(n.getAttribute("data-panel-index"));if(a+1<this.panelCount)this.showPanel(a+1);else{var l=new Date;l.setTime(l.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:l,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:l,path:"/"}),i&&i.tl(!0,"o","Photo Limit Overlay: Decline"),this.hide()}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-limit-overlay","hermes-template-photo-limit-panel","person-public-profile-models","intl-number","user-limits-helper","string-helper"],langBundles:["upload-blocking","refencing-announcement"]});YUI.add("photostream-page-view",function(e,t){var i=require("hermes-core/flog")(t);new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("photostream-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-tools-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photostream"],dealbreaker:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["photostream"]},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"photo-limit-overlay-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,overlayClassList:["light","top-aligned"]}},initializer:function(e){return this.nsid=e.nsid,this.isOwner=e.isOwner,this.withPhotoId=e.withPhotoId,this.contextSuffix=e.contextSuffix,this.pageParams=e.pageParams,this.isRouting=!1,this.isTwitterbot=e.isTwitterbot,this.isHelloPro=e.isHelloPro,e.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,e.photostreamId=e.nsid,e.modelRegistryName="photostream-models",e.photoListConfig={parentName:"photolist-container",pageParams:e.pageParams,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:e.withPhotoId,contextSuffix:e.contextSuffix},e.photoListConfig.modelParams={registryName:"photostream-models",modelIdOrAttributes:e.nsid+"-"+e.contextSuffix,collectionAttributeName:"photoPageList",fetchParams:{}},e.photoListConfig.modelParams.fetchParams.orderBy="use_pref",e.photoListConfig.modelParams.fetchParams.viewAs="use_pref",e.photoListConfig.layout={targetRowHeight:320,targetRowHeightTolerance:.1,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:0,right:0,bottom:8,left:0},itemSpacing:{horizontal:4,vertical:4}},this.photoListConfig=e.photoListConfig,e.subnavConfig={selected:"photostream"},this.geo=e.geo,this},loadState:function(){var t=this,i={},o=[];return this.withPhotoId&&(i.withPhotoId=this.withPhotoId),o.push(this.appContext.getModel("photostream-models",this.nsid+"-"+this.contextSuffix,i).then(function(e){t.set("photostreamModel",e),YUI.Env.isServer||t.recalculateNominalPage(e)})),this.appContext.flipper.isFlipped("enable-photo-limit-overlay")&&this.appContext.getViewer().signedIn&&o.push(this.appContext.getModel("person-profile-models",this.nsid).then(function(e){t.profileModel=e})),e.Promise.all(o)},buildContainer:function(){return this.setContainerWithTemplate("photostream-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"",isEmpty:!(this.isRouting||!this.get("photostreamModel"))&&0===parseInt(this.get("photostreamModel").getValue("totalItems"),10),isViewingSelf:this.nsid===this.appContext.getViewer().nsid,showPhotoLimitOverlay:this.appContext.flipper.isFlipped("enable-photo-limit-overlay")}),this},activate:function(){var t=this;this.get("container");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),this.nsid!==this.appContext.getViewer().nsid&&this.appContext.getViewCounter().recordPhotostreamView({photostreamOwnerId:this.nsid,referrer:this.appContext.getReferrer()}),this.isHelloPro?this.appContext.getModel("person-models",this.nsid).then(function(t){if(this.showHelloProModal(t),this.appContext.flipper.isFlipped("enable-digital-river")){new e.DigitalRiverHelper({appContext:this.appContext}).getAnalyticsBeaconsPrefix()}}.bind(this)):(this.limitOverlaySubview=this.subviews["photo-limit-overlay-view"],this.appContext.flipper.isFlipped("enable-photo-limit-overlay")&&e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext)&&this.limitOverlaySubview&&this.isOwner&&(this.limitOverlaySubview.isLoaded?this.setupLimitOverlay():this.limitOverlaySubview.on("loaded",function(){t.setupLimitOverlay()})),this)},onSubviewEvent:function(e,t){"photostream:filter"===t[0]&&this.appContext.flapp.navigate(window.location.href)},recalculateNominalPage:function(e){var t=0;1!==this.pageParams.page&&-1!==this.appContext.getLocation().href.search(/page[0-9]+/)&&(t=Math.ceil(e.getValue("totalItems")/this.pageParams.viewPageSize),this.pageParams.nominalPage>t&&(this.isRouting=!0,this.appContext.flapp.navigate(this.appContext.getLocation().pathname.replace(/page[0-9]+/,""))))},buildHeadContainer:function(){var t,o,a,s,r=this.get("photostreamModel"),n=r?r.getValue("photoPageList").getList():[],l="summary",h=[];if(r&&(a=n.length?this.intlMessage({intlName:"meta.PHOTOSTREAM",username:r.getValue("owner").getValue("displayname"),photoCount:r.getValue("totalItems")}):this.intlMessage({intlName:"meta.PHOTOSTREAM_NO_PHOTOS",username:r.getValue("owner").getValue("displayname")})),this.isTwitterbot)if(0+n.length>=4)for(l="gallery",s=0;s<4;s++)n[s]&&n[s].getSizeToFit?h.push({property:"twitter:image"+s,content:n[s].getSizeToFit({width:640,height:640}).url}):i.error("error calling getSizeToFit.");else i.warn("not enough photos to create twitter gallery.");t=n.length>0&&n[0]?n[0].getSizeToFit(this.nsid,{width:640,height:640}):{},o=this.templates("dynamic-page-head")({title:r?r.getValue("owner").getValue("displayname"):null,description:a,url:r?r.getValue("url"):null,fullURL:r?e.url(r.getValue("url")):null,openGraphImageURL:t.url?e.URLHelper.addProtocolToURL(t.url):null,openGraphaImageWidth:t.width,openGraphaImageHeight:t.height,ownerURL:r?r.getValue("owner").getValue("url"):null,twitterCardType:l,twitterImages:h,flickrType:"photostream",openId:!0,domain:e.url(),feeds:r?[{title:this.intlMessage({intlName:"meta.PHOTOSTREAM_ATOM_TITLE",username:r.getValue("owner").getValue("displayname")}),url:"/services/feeds/photos_public.gne?id="+r.getValue("normalizedId")+"&lang="+this.appContext.lang.toLowerCase()+"&format=atom"}]:[]}),o+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",o):(this.set("headContainer",o.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("photostreamModel").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}},showHelloProModal:function(t){var i=e.URLHelper.generatePersonUrls(t),o=new e.Views.FluidModal({actionButtonLabel:this.intlMessage({intlName:"checkout.OK_THANKS"}),htmlMessage:this.templates("simplified-pro-hello-pro")({photostreamURL:e.url(i.photostream)}),showBodyLines:!0,showHeader:!1,appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,actionButtonDisabled:!1,actionButtonIsDangerous:!1,showCancelButton:!1,hideModalOverlay:!1,classList:"welcome-pro-modal",showCancelX:!1});o.on("activated",function(t){var a=o.get("container").one(".freebrowsing"),s=o.get("container").one(".auto-uploadr"),r=o.get("container").one(".partners");a.on("click",function(t){e.config.win.location=e.url("/")}),s.on("click",function(t){e.config.win.location=e.url("/tools")}),r.on("click",function(t){e.config.win.location=e.url("/account")});var n=new Date;n.setTime(n.getTime()+2592e6),this.appContext.setCookie({cookieName:e.config.flickr.banners.dismiss_early_renewal_banner_name,cookieValue:1,expires:n,path:"/"}),setTimeout(function(){e.config.win.history.replaceState({},"",i.photostream)},1e3)}),o.on("actionClick",function(t){e.config.win.location=e.url(i.photostream)}),o.show()},setupLimitOverlay:function(){var t=this.get("container");this.limitOverlaySubview.show(),this.photoListSubview=this.subviews["photo-list-view"],t.addClass("with-photo-limit-overlay"),setTimeout(function(){e.config.win.scrollTo(0,0)},200),this.registerEventHandler(e.on("photoLimitOverlay:hidden",function(){t.removeClass("with-photo-limit-overlay")}))}},{ATTRS:{spaceid:{value:792600537}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-photostream-page","global-nav-view","footer-full-view","photo-list-view","pagination-view","person-models","fluid-photostream-coverphoto-view","fluid-magic-subnav-view","fluid-modal-view","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-simplified-pro-hello-pro","url-helper","digital-river-helper","subscriptions-helper","storage-helper","photo-limit-overlay-view"],optional:["photostream-models"],langBundles:["header","common","meta","checkout","magic-empty-states","filter-bar"]});YUI.add("hermes-lang-meta",function(e,o){e.Intl.add("hermes/meta","en-US",{PHOTOSTREAM:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"photo on Flickr!",other:"${#} photos on Flickr!"}}],PHOTOSTREAM_NO_PHOTOS:["Explore ","${username}","'s photos on Flickr!"],ALBUMS_LIST:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"album on Flickr!",other:"${#} albums on Flickr!"}}],ALBUMS_LIST_NO_ALBUMS:["Explore ","${username}","'s albums on Flickr!"],FAVORITES:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"favorites on Flickr!",other:"${#} favorites on Flickr!"}}],FAVORITES_NO_PHOTOS:["Explore ","${username}","'s favorites on Flickr!"],META_DESCRIPTION_BY_USER_ON_FLICKR:["By ","${username}"," on Flickr"],PHOTOSTREAM_ATOM_TITLE:["Flickr: ","${username}","'s Photostream Atom feed"],FAVORITES_ATOM_TITLE:["Flickr: ","${username}","'s Favorites Atom feed"],GROUP_POOL_ATOM_TITLE:["Flickr: ","${groupName}","'s Photos Atom feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr: ","${groupName}","'s Discussions Atom feed"],ALBUM_ATOM_TITLE:["Flickr: ","${username}","'s \"","${albumTitle}",'" Atom feed']})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-photo-list-photo-interaction",function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,a,l){var s;return n.escapeExpression(n.lambda(null!=(s=null!=t?t.photo:t)?s.title:s,t))},3:function(n,t,e,a,l){return n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:l}))},5:function(n,t,e,a,l){return" "+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.BY_YOU"},data:l}))},7:function(n,t,e,a,l){var s;return" "+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{user:null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.username:s,intlName:"common.BY_USER"},data:l}))},9:function(n,t,e,a,l){var s,o=null!=t?t:{};return'\t\t<div class="extra-tools">\n'+(null!=(s=e.if.call(o,null!=t?t.removeToolClass:t,{name:"if",hash:{},fn:n.program(10,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(o,null!=t?t.bigScotchTitle:t,{name:"if",hash:{},fn:n.program(12,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(o,null!=t?t.moreMenuItems:t,{name:"if",hash:{},fn:n.program(14,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t</div>\n"},10:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<div class="extra-tool remove-photo '+i("function"==typeof(o=null!=(o=e.removeToolClass||(null!=t?t.removeToolClass:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"removeToolClass",hash:{},data:l}):o)+'" data-id='+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+"></div>\n"},12:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<div class="extra-tool big-scotch" data-id='+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+' title="'+i("function"==typeof(o=null!=(o=e.bigScotchTitle||(null!=t?t.bigScotchTitle:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"bigScotchTitle",hash:{},data:l}):o)+'"></div>\n'},14:function(n,t,e,a,l){var s,o,i=null!=t?t:{},r=e.helperMissing,u=n.escapeExpression;return'\t\t\t\t<div class="extra-tool more-menu" data-menu-items="'+u("function"==typeof(o=null!=(o=e.moreMenuItems||(null!=t?t.moreMenuItems:t))?o:r)?o.call(i,{name:"moreMenuItems",hash:{},data:l}):o)+'" data-id='+u(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+' title="'+u((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.MORE"},data:l}))+'"></div>\n'},16:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<a href="'+i("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"photoPageUrl",hash:{},data:l}):o)+'" class="title" tabindex="-1">'+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.title:s,t))+"</a>\n"},18:function(n,t,e,a,l){return'\t\t\t\t<span class="title empty"> </span>\n'},20:function(n,t,e,a,l){var s;return'\t\t\t\t<a href="'+n.escapeExpression(n.lambda(null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.url:s,t))+'" class="attribution">\n'+(null!=(s=(e.photoAttribution||t&&t.photoAttribution||e.helperMissing).call(null!=t?t:{},null!=t?t.photo:t,null!=t?t.flippers:t,{name:"photoAttribution",hash:{},fn:n.program(21,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t\t\t</a>\n"},21:function(n,t,e,a,l){var s;return null!=(s=e.if.call(null!=t?t:{},null!=t?t.intlName:t,{name:"if",hash:{},fn:n.program(22,l,0),inverse:n.program(24,l,0),data:l}))?s:""},22:function(n,t,e,a,l){return"\t\t\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{user:null!=t?t.user:t,intlName:null!=t?t.intlName:t},data:l}))+"\n"},24:function(n,t,e,a,l){var s;return"\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(s=null!=(s=e.user||(null!=t?t.user:t))?s:e.helperMissing)?s.call(null!=t?t:{},{name:"user",hash:{},data:l}):s)+"\n"},26:function(n,t,e,a,l){return'\t\t\t\t<span class="attribution empty"> </span>\n'},28:function(n,t,e,a,l){return" faved"},30:function(n,t,e,a,l){return" can-not-fave"},32:function(n,t,e,a,l){return'\t\t\t\t\taria-label="'+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:l}))+'"\n'},34:function(n,t,e,a,l){return'\t\t\t\t\taria-label="'+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.ADD_TO_FAVORITES"},data:l}))+'"\n'},36:function(n,t,e,a,l){return'tabindex="-1"'},38:function(n,t,e,a,l){var s;return n.escapeExpression((e.formatNumber||t&&t.formatNumber||e.helperMissing).call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.faveCount:s,{name:"formatNumber",hash:{},data:l}))},40:function(n,t,e,a,l){return" hidden"},42:function(n,t,e,a,l){var s;return n.escapeExpression((e.formatNumber||t&&t.formatNumber||e.helperMissing).call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"formatNumber",hash:{},data:l}))},44:function(n,t,e,a,l){return'\t\t\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n'},compiler:[7,">= 4.0.0"],main:function(n,t,e,a,l){var s,o,i=null!=t?t:{},r=e.helperMissing,u=n.escapeExpression;return'<div class="photo-list-photo-interaction">\n\t<a class="overlay" href="'+u("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:r)?o.call(i,{name:"photoPageUrl",hash:{},data:l}):o)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(3,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.program(7,l,0),data:l}))?s:"")+'"></a>\n'+(null!=(s=e.if.call(i,null!=t?t.hasExtraFunctionality:t,{name:"if",hash:{},fn:n.program(9,l,0),inverse:n.noop,data:l}))?s:"")+'\t<div class="interaction-bar" title="'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(3,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.program(7,l,0),data:l}))?s:"")+'">\n\t\t<div class="text">\n'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(16,l,0),inverse:n.program(18,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.displayname:s,{name:"if",hash:{},fn:n.program(20,l,0),inverse:n.program(26,l,0),data:l}))?s:"")+'\t\t</div>\n\n\t\t<div class="engagement">\n\t\t\t\n\t\t\t<span role="button" class="engagement-item fave '+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.isFaved:s,{name:"if",hash:{},fn:n.program(28,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=t?t.canFave:t,{name:"if",hash:{},fn:n.noop,inverse:n.program(30,l,0),data:l}))?s:"")+'" tabindex="0"\n'+(null!=(s=e.if.call(i,null!=t?t.isFaved:t,{name:"if",hash:{},fn:n.program(32,l,0),inverse:n.program(34,l,0),data:l}))?s:"")+"\t\t\t\t"+(null!=(s=e.unless.call(i,null!=t?t.canFave:t,{name:"unless",hash:{},fn:n.program(36,l,0),inverse:n.noop,data:l}))?s:"")+'>\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n\t\t\t\t\t<svg class="icon icon-fave filled"><use xlink:href="#icon-fave"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count">\n\t\t\t\t\t'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.faveCount:s,{name:"if",hash:{},fn:n.program(38,l,0),inverse:n.noop,data:l}))?s:"")+'\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<a class="engagement-item comment" href="'+u("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:r)?o.call(i,{name:"photoPageUrl",hash:{},data:l}):o)+'#comments" aria-label="'+u((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_COMMENT"},data:l}))+'" tabindex="0">\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"if",hash:{},fn:n.noop,inverse:n.program(40,l,0),data:l}))?s:"")+'">\n\t\t\t\t\t'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"if",hash:{},fn:n.program(42,l,0),inverse:n.noop,data:l}))?s:"")+"\n\t\t\t\t</span>\n\t\t\t</a>\n\n"+(null!=(s=e.if.call(i,null!=t?t.displayCurate:t,{name:"if",hash:{},fn:n.program(44,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t</div>\n\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(t){var e=n.Template.get("hermes/"+t);e&&(a[t]=e)}),n.Template.register("hermes/photo-list-photo-interaction",function(t,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,e(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comment-item-view",function(t,n){var a=t.Template.Handlebars.revive({1:function(t,n,a,e,l){var r,s=t.lambda,i=t.escapeExpression;return'\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(r=null!=(r=null!=n?n.author:n)?r.buddyicon:r)?r.default:r,n))+');" href="/photos/'+i(s(null!=(r=null!=n?n.author:n)?r.pathAlias:r,n))+'/"></a>\n'},3:function(t,n,a,e,l){var r,s=t.lambda,i=t.escapeExpression;return'\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(r=null!=n?n.author:n)?r.buddyicon:r,n))+');" href="/photos/'+i(s(null!=(r=null!=n?n.author:n)?r.pathAlias:r,n))+'/"></a>\n'},5:function(t,n,a,e,l){var r,s=t.escapeExpression;return'\t\t\t\t\t<span class="deleted">'+s(t.lambda(null!=(r=null!=n?n.author:n)?r.displayname:r,n))+" ("+s((a.intlMessage||n&&n.intlMessage||a.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:l}))+")</span>\n"},7:function(t,n,a,e,l){var r,s=t.lambda,i=t.escapeExpression;return'\t\t\t\t\t<a href="/photos/'+i(s(null!=(r=null!=n?n.author:n)?r.pathAlias:r,n))+'/" class="author-name" >'+i(s(null!=(r=null!=n?n.author:n)?r.displayname:r,n))+"</a>\n"},9:function(t,n,a,e,l){var r;return null!=(r=t.invokePartial(e["pro-badge"],n,{name:"pro-badge",hash:{badgeType:null!=(r=null!=n?n.author:n)?r.proBadge:r},data:l,indent:"\t\t\t\t\t",helpers:a,partials:e,decorators:t.decorators}))?r:""},11:function(t,n,a,e,l){return t.escapeExpression((a.intlMessage||n&&n.intlMessage||a.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{time:null!=n?n.time:n,intlName:null!=n?n.intlName:n},data:l}))},13:function(t,n,a,e,l){var r;return null!=(r=a.if.call(null!=n?n:{},null!=n?n.hasEditPrivileges:n,{name:"if",hash:{},fn:t.program(14,l,0),inverse:t.program(16,l,0),data:l}))?r:""},14:function(t,n,a,e,l){return'\t\t\t\t\t\t<a role="button" class="comment-action comment-action-menu-button" data-menutype="owner">\n\t\t\t\t\t\t\t<svg class="icon icon-more_horizontal"><use xlink:href="#icon-more_horizontal"></use></svg>\n\t\t\t\t\t\t</a>\n'},16:function(t,n,a,e,l){var r;return'\t\t\t\t\t\t\t<a role="button" class="comment-action comment-action-reply-button" data-action="reply" data-pathalias="'+t.escapeExpression(t.lambda(null!=(r=null!=n?n.author:n)?r.pathAlias:r,n))+'">\n\t\t\t\t\t\t\t\t<svg class="icon icon-comment_reply"><use xlink:href="#icon-comment_reply"></use></svg>\n\t\t\t\t\t\t\t</a>\n'+(null!=(r=a.if.call(null!=n?n:{},null!=n?n.hasOnlyDeletePrivileges:n,{name:"if",hash:{},fn:t.program(17,l,0),inverse:t.noop,data:l}))?r:"")},17:function(t,n,a,e,l){return'\t\t\t\t\t\t\t\t<a role="button" class="comment-action comment-action-menu-button" data-menutype="curator">\n\t\t\t\t\t\t\t\t\t<svg class="icon icon-more_horizontal"><use xlink:href="#icon-more_horizontal"></use></svg>\n\t\t\t\t\t\t\t\t</a>\n'},19:function(t,n,a,e,l){var r;return'\t\t\t\t\t<a role="button" class="comment-action comment-action-reply-button" data-action="reply" data-pathalias="'+t.escapeExpression(t.lambda(null!=(r=null!=n?n.author:n)?r.pathAlias:r,n))+'">\n\t\t\t\t\t\t<svg class="icon icon-comment_reply"><use xlink:href="#icon-comment_reply"></use></svg>\n\t\t\t\t\t</a>\n'},compiler:[7,">= 4.0.0"],main:function(t,n,a,e,l){var r,s,i=null!=n?n:{},o=a.helperMissing,u=t.escapeExpression;return'<div class="comment-item" data-id="'+u("function"==typeof(s=null!=(s=a.id||(null!=n?n.id:n))?s:o)?s.call(i,{name:"id",hash:{},data:l}):s)+'">\n\n'+(null!=(r=a.if.call(i,null!=(r=null!=(r=null!=n?n.author:n)?r.buddyicon:r)?r.default:r,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.program(3,l,0),data:l}))?r:"")+'\n\t<div class="content-container">\n\t\t<header>\n\t\t\t<div class="author-info">\n'+(null!=(r=a.if.call(i,null!=(r=null!=n?n.author:n)?r.isDeleted:r,{name:"if",hash:{},fn:t.program(5,l,0),inverse:t.program(7,l,0),data:l}))?r:"")+"\n"+(null!=(r=a.if.call(i,null!=(r=null!=n?n.author:n)?r.isPro:r,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.noop,data:l}))?r:"")+'\n\t\t\t\t<span class="comment-date">'+(null!=(r=(a.friendlySinceDate||n&&n.friendlySinceDate||o).call(i,null!=n?n.timeago:n,!0,!1,{name:"friendlySinceDate",hash:{},fn:t.program(11,l,0),inverse:t.noop,data:l}))?r:"")+'</span>\n\t\t\t</div>\n\n\t\t\t<div class="comment-actions">\n'+(null!=(r=a.if.call(i,null!=n?n.isSignedIn:n,{name:"if",hash:{},fn:t.program(13,l,0),inverse:t.program(19,l,0),data:l}))?r:"")+'\n\t\t\t</div>\n\t\t</header>\n\n\t\t<div class="comment-content">'+u((a.renderTrustedMarkupWithLineBreaks||n&&n.renderTrustedMarkupWithLineBreaks||o).call(i,null!=n?n.contentSecure:n,{name:"renderTrustedMarkupWithLineBreaks",hash:{},data:l}))+"</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),e={};t.Array.each(["pro-badge"],function(n){var a=t.Template.get("hermes/"+n);a&&(e[n]=a)}),t.Template.register("hermes/comment-item-view",function(n,l){return l=l||{},l.partials=l.partials?t.merge(e,l.partials):e,a(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge"]});YUI.add("comment-item-view",function(e,i){e.namespace("Views")[this.name]=e.Base.create("comment-item-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.isSignedIn=this.appContext.getViewer().signedIn,this.hasEditPrivileges=this.appContext.getViewer().nsid===this.params.author.id,this.hasOnlyDeletePrivileges=this.params.isSubjectOwner},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e={id:this.params.id,author:this.params.author,content:this.params.content,contentSecure:this.params.contentSecure,date:this.params.date,timeago:this.params.timeago,isSignedIn:this.isSignedIn,hasEditPrivileges:this.hasEditPrivileges,hasOnlyDeletePrivileges:this.hasOnlyDeletePrivileges};this.setContainerWithTemplate("comment-item-view",e)}})},"@VERSION@",{requires:["hermes-template-comment-item-view"],langBundles:["common","relative-dates"]});YUI.add("hermes-template-add-comment-view",function(n,a){var e=n.Template.Handlebars.revive({1:function(n,a,e,t,l){var r,s,i=null!=a?a:{},u=e.helperMissing,o=n.escapeExpression;return'<div class="comment-area" tabindex="-1">\n'+(null!=(r=e.if.call(i,null!=a?a.signedIn:a,{name:"if",hash:{},fn:n.program(2,l,0),inverse:n.program(7,l,0),data:l}))?r:"")+'\n\t<div class="text-area-container">\n\t\t<textarea placeholder="'+o("function"==typeof(s=null!=(s=e.placeholderText||(null!=a?a.placeholderText:a))?s:u)?s.call(i,{name:"placeholderText",hash:{},data:l}):s)+'" class="comment-field" tabindex="0"></textarea>\n\t\t<div class="comment-arrow"></div>\n\t</div>\n</div>\n<div class="buttons comment-buttons hidden">\n\t<button type="button" class="action comment-button">'+o((e.intlMessage||a&&a.intlMessage||u).call(i,{name:"intlMessage",hash:{intlName:"gallery.ADD_COMMENT"},data:l}))+"</button>\n</div>\n"},2:function(n,a,e,t,l){var r;return null!=(r=e.if.call(null!=a?a:{},null!=(r=null!=(r=null!=a?a.user:a)?r.buddyicon:r)?r.default:r,{name:"if",hash:{},fn:n.program(3,l,0),inverse:n.program(5,l,0),data:l}))?r:""},3:function(n,a,e,t,l){var r,s=n.lambda,i=n.escapeExpression;return'\t\t\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(r=null!=(r=null!=a?a.user:a)?r.buddyicon:r)?r.default:r,a))+');" href="/photos/'+i(s(null!=(r=null!=a?a.user:a)?r.pathAlias:r,a))+'/"></a>\n'},5:function(n,a,e,t,l){var r,s=n.lambda,i=n.escapeExpression;return'\t\t\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(r=null!=a?a.user:a)?r.buddyicon:r,a))+');" href="/photos/'+i(s(null!=(r=null!=a?a.user:a)?r.pathAlias:r,a))+'/"></a>\n'},7:function(n,a,e,t,l){return'\t\t<a class="avatar person tiny no-menu signed-out-icon" style="background-image: url(https://combo.staticflickr.com/pw/images/buddyicon04_m.png);"></a>\n'},9:function(n,a,e,t,l){var r=null!=a?a:{},s=e.helperMissing;return'<div class="comments-disabled-container">\n\t<span>'+n.escapeExpression((e.preventOrphans||a&&a.preventOrphans||s).call(r,(e.intlMessage||a&&a.intlMessage||s).call(r,{name:"intlMessage",hash:{intlName:"comments.COMMENTING_DISABLED"},data:l}),{name:"preventOrphans",hash:{},data:l}))+"</span>\n</div>\n"},compiler:[7,">= 4.0.0"],main:function(n,a,e,t,l){var r;return null!=(r=e.if.call(null!=a?a:{},null!=a?a.commentingEnabled:a,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(9,l,0),data:l}))?r:""},useData:!0}),t={};n.Array.each([],function(a){var e=n.Template.get("hermes/"+a);e&&(t[a]=e)}),n.Template.register("hermes/add-comment-view",function(a,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,e(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("add-comment-view",function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.config=this.params.addCommentConfig,this.signedIn=this.appContext.getViewer().signedIn,this.commentingEnabled=!0,this.addCommentText=this.config.addCommentText||this.intlMessage({intlName:"comments.ADD_A_COMMENT"})},loadState:function(){var t=this,n=[this.appContext.getModelRegistry(this.config.commentModelRegistryName).then(function(e){t.commentModelRegistry=e})];return this.signedIn&&n.push(this.appContext.getModel("person-models",{id:this.appContext.getViewer().nsid}).then(function(e){t.userModel=e})),this.config.galleryId&&n.push(this.appContext.getModel("gallery-info-models",{id:this.config.galleryId}).then(function(e){t.galleryInfoModel=e})),this.params.photoId&&n.push(this.appContext.getModel("photo-models",{id:this.params.photoId}).then(function(e){t.photoModel=e,t.commentingEnabled=!t.signedIn||t.photoModel.getValue("canComment")})),e.Promise.all(n)},buildContainer:function(){this.setContainerWithTemplate("add-comment-view",{user:this.signedIn?this.userModel.toJSON():null,signedIn:this.signedIn,placeholderText:this.getPlaceholderText(),commentingEnabled:this.commentingEnabled})},activate:function(){var t=this.get("container");this.commentButton=t.one(".comment-button"),this.commentField=t.one(".comment-field"),this.commentButtonsContainer=t.one(".buttons.comment-buttons"),this.signedIn||(this.signedOutIcon=t.one(".signed-out-icon"),this.registerEventHandler(this.signedOutIcon.on("mousedown",this.handleCommentFocus.bind(this)))),this.commentingEnabled&&(this.registerEventHandler(this.commentButton.on("click",this.handleAddCommentClick.bind(this))),this.registerEventHandler(this.commentField.on("focus",this.handleCommentFocus.bind(this))),this.registerEventHandler(e.on("click",this.handleContainerClick.bind(this))),t.ancestor(".fluid-droparound-view")&&setTimeout(function(){t.one(".comment-area").focus()},0))},getPlaceholderText:function(){return this.signedIn?this.config.addCommentText:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"comments.LOGIN_TO_COMMENT"}):this.config.addCommentText},handleAddCommentClick:function(e){this.addComment(this.commentField.get("value"))},addComment:function(t){var i=this;if(t)return this.commentField.set("value",""),this.commentButton.setAttribute("disabled"),this.commentField.removeClass("focused"),this.commentButtonsContainer.addClass("hidden"),this.fakeAddComment=function(){return e.Promise.resolve({comment:{id:"72157688007210754-tmpp",content:t,contentSecure:t},stat:"ok"})},i.fire("subviewViewEvent",{eventName:"commentAddLoading",isLoading:!0}),this.addCommentCall(t).then(function(e){i.fire("subviewViewEvent",{eventName:"commentAdded",commentModel:e}),i.commentButton.removeAttribute("disabled")}).catch(function(e){i.commentButton.removeAttribute("disabled"),i.fire("subviewViewEvent",{eventName:"commentAddLoading",isLoading:!1}),n.error("Error adding gallery comment",{err:e})})},addCommentCall:function(e){return"gallery"===this.params.addCommentConfig.type?this.addGalleryComment(e):"photo"===this.params.addCommentConfig.type?this.addPhotoComment(e):void 0},handleCommentFocus:function(e){this.signedIn?(this.commentField.addClass("focused"),this.commentButtonsContainer.removeClass("hidden")):(e&&e.preventDefault(),this.showSignUpModal())},addReplyMessage:function(t,n){var i="",o=this.commentField.get("value");this.signedIn?(o.length>0&&(i+=o+" "),i+="["+e.url("/photos/"+t)+"] ",this.handleCommentFocus(!0),this.commentField.focus(),this.commentField.set("value",i),n&&this.commentField.scrollIntoView()):this.showSignUpModal()},showSignUpModal:function(){var t,n=e.config.win.location.href,i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"});e.fire("addComment:showingSignupModal"),(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:i,signUpMessage:o,beaconPrefix:"addComment"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:n})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:n})}),t.show()},handleContainerClick:function(e){this.checkCommentUnfocus(e)},checkCommentUnfocus:function(e){var t=e.target;t.ancestor(".add-comment-view",!0)||t.ancestor(".comment-action-reply-button",!0)||(this.commentButtonsContainer.addClass("hidden"),this.commentField.removeClass("focused"))},addGalleryComment:function(e){return this.commentModelRegistry.remoteCreate({galleryId:this.galleryInfoModel.getValue("id"),galleryOwnerId:this.galleryInfoModel.getValue("owner").getValue("id"),commentText:e,authorId:this.userModel.getValue("id")})},addPhotoComment:function(e){return this.commentModelRegistry.remoteCreate({photoId:this.params.photoId,commentText:e})},focusCommentBox:function(){this.commentField&&this.commentField.focus()}})},"@VERSION@",{requires:["flickr-view","signup-modal-view","hermes-template-add-comment-view"],langBundles:["gallery","photo-page-scrappy","stats","comments","common"]});YUI.add("hermes-lang-comments",function(e,o){e.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],LOGIN_TO_COMMENT:["Login to comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>'],SIGNUP_MODAL_TITLE:["Comment on this photo!"],SIGNUP_MODAL_MESSAGE:["Join Flickr to leave a comment on this photo"],VIEW_COMMENTS:["View Comments"],COMMENTING_DISABLED:["Commenting is disabled for this photo."],VIEW_ON_PHOTO_PAGE:["View all comments on the photo page"],ADD_GALLERY_COMMENT:["Add a comment about this gallery"],ADD_PHOTO_COMMENT:["Add a comment about this ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}],SELECT_EMOJI:["Select emoji"]})},"@VERSION@",{requires:["intl"]});YUI.add("comment-list-view",function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")["comment-list-view"]=e.Base.create("comment-list-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.modelConfig=e.commentListConfig,this.perPage=this.modelConfig.perPage||16,this.firstPerPage=this.modelConfig.firstPerPage||16,this.commentsPage=0,this.renderedCommentModels=[],this.isSubjectOwner=!1},activate:function(){var e=this.get("container");return e.addClass("comment-list-view"),this.commentsListNode=e.one(".comment-list"),this.registerEventHandler(this.commentsListNode.delegate("click",this.handleCommentActionClick.bind(this),".comment-actions")),this.loadComments()},resetComments:function(){return this.renderedCommentModels=[],this.commentsPage=0,this.commentsListNode.set("innerHTML",""),this.loadComments()},loadComments:function(){var t=this,o=t.appContext.getViewer().nsid,i=t.appContext.getViewer().signedIn,m=[this.appContext.getModelRegistry(this.modelConfig.commentModelRegistryName).then(function(e){t.commentModelRegistry=e}),this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.listModel=e})];switch(this.modelConfig.listRegistryName){case"gallery-info-models":m.push(this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.isSubjectOwner=i&&o===e.getValue("owner").getValue("nsid")}));break;case"photo-comments-models":m.push(this.appContext.getModel("photo-models",this.modelConfig.modelId).then(function(e){t.isSubjectOwner=o===e.getValue("owner").getValue("nsid")})),m.push(this.appContext.getModel("photo-engagement-models",this.params.photoId).then(function(e){t.engagementModel=e}))}return e.Promise.all(m).then(function(e){var n=t.listModel.getValue(t.modelConfig.collectionName).getList();return t.commentsPage=Math.ceil(n.length/t.perPage),"-1"===t.listModel.getValue(t.modelConfig.listRegistryContinuationName)&&(t.endOfComments=!0),0!==n.length?t.updateComments(n):t.getComments()}).then(function(){var e=t.get("container").all("img.notsowide"),n=e._nodes.length,o=0;0===n?t.handleLoadCommentsComplete():e.on(["load","error"],function(e){++o===n&&t.handleLoadCommentsComplete()})}).catch(function(e){n.error("Error getting info",{err:e})})},getComments:function(){var t,o=this;return this.endOfComments?e.Promise.resolve():(this.isFetchingComments=!0,"gallery"===this.modelConfig.type?t=this.getGalleryComments():"photo"===this.modelConfig.type&&(t=this.getPhotoComments()),t.then(function(){o.isFetchingComments=!1}).catch(function(e){n.error("Error getting comments",{err:e}),o.isFetchingComments=!1}))},getGalleryComments:function(){var e=this,t=this.notFirstPage?this.perPage:this.firstPerPage,n=this.listModel.getValue(e.modelConfig.collectionName).getList(),o=this.renderedCommentModels.length,i=[];if(n.length>o+t){for(var m=o;m<o+t;m++)i.push(n[m]);return e.updateComments(i)}return this.listModel.getCommentsByContinuation(t).then(function(t){return e.notFirstPage=!0,"-1"===e.listModel.getValue(e.modelConfig.listRegistryContinuationName)&&(e.endOfComments=!0),e.updateComments(t)})},getPhotoComments:function(){var t=this;return 0===this.engagementModel.getValue("commentCount")?(this.endOfComments=!0,e.Promise.resolve()):this.listModel.getValue(this.modelConfig.collectionName).getRange({offset:this.listModel.getValue(this.modelConfig.collectionName).getList().length,limit:this.perPage}).then(function(e){return t.commentsPage++,e.length<16&&(t.endOfComments=!0),t.updateComments(e)})},getMoreComments:function(){var t=this;return this.endOfComments?e.Promise.resolve():(this.showCommentLoading(!0),this.getComments().then(function(){t.showCommentLoading(!1)}))},showBalls:function(t){this.balls||(this.balls=e.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),t?(this.balls.addClass("bottom"),this.commentsListNode.append(this.balls)):this.commentsListNode.prepend(this.balls)},hideBalls:function(){this.balls&&(this.balls.removeClass("bottom"),this.balls.remove())},appendNewComment:function(t){var n=this,o=Object.assign(t.toJSON(),{appContext:this.appContext}),i=new e.Views["comment-item-view"](o);i.initialize(o).then(function(){i.activate()}).then(function(){var t=e.Node.create('<li class="comment-list-item"></li>');t.append(i.get("container")),n.commentsListNode.append(t),n.showCommentAddLoading(!1)}).then(function(){n.handleCommentViewAppended(i)})},handleCommentActionClick:function(e){var t=e.target,n=t.ancestor(".comment-item"),o=n.getAttribute("data-id");t.ancestor(".comment-action-menu-button",!0)&&this.showCommentActionMenu(o,n,t.ancestor(".comment-action-menu-button",!0).getAttribute("data-menutype")),t.ancestor(".comment-action-reply-button",!0)&&(e.preventDefault(),this.fire("subviewViewEvent",{eventName:"replyClicked",pathAliasOrNSID:t.ancestor(".comment-action-reply-button",!0).getAttribute("data-pathalias")}))},showCommentActionMenu:function(t,n,o){var i=this,m=[{text:this.intlMessage({intlName:"common.DELETE"}),value:"delete-comment-action"}];"owner"===o&&m.push({text:this.intlMessage({intlName:"common.EDIT"}),value:"edit-comment-action"}),n.addClass("active"),this.commentActionMenu||(this.commentActionMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnActionClick:!0,showDropArrow:!0,anchorElement:n.one(".comment-action-menu-button"),anchorOffsetHorizontal:11,classList:"over-modal comment-action-menu",overlayClassList:"over-modal",menuItems:m}),this.commentActionMenu.show(),this.registerEventHandler(this.commentActionMenu.on("closeDroparound",function(e){n.removeClass("active"),i.commentActionMenu=null})),this.registerEventHandler(this.commentActionMenu.on("selected",function(e){i.commentActionMenu.close(),"delete-comment-action"===e.menuItem.value?i.deleteComment(t,n):"edit-comment-action"===e.menuItem.value&&i.showEditComment(t,n)})))},deleteComment:function(e,t){return t.ancestor("li").remove(),this.deleteCommentCall(e)},deleteCommentCall:function(e){return"gallery"===this.modelConfig.type?this.deleteGalleryComment(e):"photo"===this.modelConfig.type?this.deletePhotoComment(e):void 0},showEditComment:function(e,t){var o=this,i=t.one(".content-container"),m=i.one(".comment-content");if(!this.isEditingComment)return this.isEditingComment=!0,this.commentModelRegistry.get(e).then(function(t){var s,l=m.get("offsetHeight");m.hide(),i.append(o.templates("comment-edit")({content:t.getValue("contentRaw")})),o.editCommentNode=i.one(".comment-edit"),(s=o.editCommentNode.one(".edit-field")).setStyle("height",Math.min(Math.max(l,100),200)),s.select(),o.registerEventHandler(o.editCommentNode.one(".cancel-edit-button").on("click",function(){m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})),o.registerEventHandler(o.editCommentNode.one(".submit-edit-button").on("click",function(){o.updateComment(e,s.get("value"),m).then(function(e){m.set("innerHTML",e.getValue("contentSecure")),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1}).catch(function(e){n.error("Error editing comment",{err:e}),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})}))})},updateComment:function(e,t){return this.updateCommentCall(e,t)},updateCommentCall:function(e,t){return"gallery"===this.modelConfig.type?this.updateGalleryComment(e,t):"photo"===this.modelConfig.type?this.updatePhotoComment(e,t):void 0},deleteGalleryComment:function(e){return this.commentModelRegistry.deleteRemote(e)},deletePhotoComment:function(e){var t=this;return this.commentModelRegistry.remoteDelete(e).then(function(){t.fire("subviewViewEvent",{eventName:"commentDeleted",commentModelId:e})})},updateGalleryComment:function(e,t){return this.commentModelRegistry.updateRemote(e,t)},updatePhotoComment:function(e,t){var n=this;return this.commentModelRegistry.get(e).then(function(o){return o.setValue("content",t),n.commentModelRegistry.remoteUpdate(e)})},delayPromise:function(t,n){return new e.Promise(function(e){setTimeout(function(){return e(n())},t)})},setLoading:function(e){this.isLoading=e},updateComments:function(e){},handleCommentViewAppended:function(){},showCommentLoading:function(){},showCommentAddLoading:function(){}})},"@VERSION@",{requires:["flickr-view","comment-item-view"],langBundles:["gallery","stats","comments","common"]});
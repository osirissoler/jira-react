YUI.add("hermes-template-fluid-magic-search",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,r,t){return e.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"search.SEARCH_PHOTOSTREAM"},data:t}))},3:function(e,a,n,r,t){return e.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"search.SEARCH_FAVORITES"},data:t}))},5:function(e,a,n,r,t){return'data-track="addContextPhotostream"'},7:function(e,a,n,r,t){return'data-track="addContextFaves"'},compiler:[7,">= 4.0.0"],main:function(e,a,n,r,t){var s,l=null!=a?a:{},i=n.helperMissing;return'<a href="#" class="search-toggle" title="'+(null!=(s=(n.ifCond||a&&a.ifCond||i).call(l,null!=a?a.pageType:a,"===","photostream",{name:"ifCond",hash:{},fn:e.program(1,t,0),inverse:e.program(3,t,0),data:t}))?s:"")+'" '+(null!=(s=(n.ifCond||a&&a.ifCond||i).call(l,null!=a?a.pageType:a,"===","photostream",{name:"ifCond",hash:{},fn:e.program(5,t,0),inverse:e.program(7,t,0),data:t}))?s:"")+'><span></span></a>\n<input tabindex="-1" class="magic-search" placeholder="'+(null!=(s=(n.ifCond||a&&a.ifCond||i).call(l,null!=a?a.pageType:a,"===","photostream",{name:"ifCond",hash:{},fn:e.program(1,t,0),inverse:e.program(3,t,0),data:t}))?s:"")+'" type="text" value=""></input>\n'},useData:!0}),r={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(r[a]=n)}),e.Template.register("hermes/fluid-magic-search",function(a,t){return t=t||{},t.partials=t.partials?e.merge(r,t.partials):r,n(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-magic-search-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fluid-magic-search-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.selected=e.subnavConfig?e.subnavConfig.selected:"",this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(e){this.set("personModel",e)}.bind(this))},buildContainer:function(){return this.setContainerWithTemplate("fluid-magic-search",{pageType:this.selected}),this},handleSearchContextRemoval:function(){this.get("container").one(".search-toggle > span").removeClass("active")},activate:function(){var t=this.get("container").one(".magic-search");return t&&(this.registerEventHandler(this.get("container").one(".search-toggle").on("click",this.toggleSearch.bind(this))),this.registerEventHandler(t.on("keyup",this.performSearch.bind(this))),this.registerEventHandler(this.get("container").one(".search-toggle").on(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this)))),this.registerEventHandler(e.on("remove-context-in-search-field",this.handleSearchContextRemoval.bind(this))),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".fluid-magic-search-view");t&&t.toggleClass("has-keyboard-focus")},toggleSearch:function(t){this.get("container");t.halt(),e.fire("add-context-to-search-field",{name:this.get("personModel").getValue("displayname"),id:this.nsid,type:"user",scope:this.selected}),t.target.addClass("active")},performSearch:function(t){var i,s=this.get("container").one(".magic-search").get("value");t.keyCode&&13!==t.keyCode||(t.halt(),"photostream"===this.selected?i=new e.SearchUrl({userId:this.nsid,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):"favorites"===this.selected&&(i=this.nsid===this.appContext.getViewer().nsid?new e.SearchUrl({faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):new e.SearchUrl({userId:this.nsid,faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS)),i.setSearchTerm(s),this.appContext.flapp.navigate(i.getURL()))}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-fluid-magic-search","search-url"],langBundles:["common","search","fluid-toolbar"]});